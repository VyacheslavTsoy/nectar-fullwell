<style>
    #{{ section.id }} {
        background-color: {{ section.settings.background_color }};
        padding: {{ section.settings.vertical_indent | times: 0.1 }}rem 0;
        color: {{ section.settings.text_color }};
        justify-content: {{ section.settings.text_alignment }};
    }

    #{{ section.id }} .announcement-bar__inner {
        gap: {{ section.settings.gap | times: 0.1 }}rem;
    }
</style>

{% assign timer = section.blocks | where: 'type', 'timer' | first %}

{% assign is_reasons_page = false %}

{% if template contains 'reasons' or template contains 'offer-only-flavors' %}
    {% assign is_reasons_page = true %}
{% endif %}

{%- capture h_align -%}
    {%- if section.settings.text_alignment == "left" -%}
        justify-start
    {%- elsif section.settings.text_alignment == "center" -%}
        justify-center
    {%- elsif section.settings.text_alignment == "right" -%}
        justify-end
    {%- endif -%}
{%- endcapture -%}

<div class="announcement-bar" id="{{ section.id }}">
    <div class="announcement-bar__inner flex {{ h_align }} items-center">
        {% for block in section.blocks %}
            {%- case block.type -%}
              {%- when "text" -%}
                {% if is_reasons_page %}
                    <style>
                        .announcement-bar__text p {
                            margin-bottom: 0;
                            line-height: 1.2;
                        }
                        .announcement-bar__text p:last-child {
                            font-size: 1.3rem;
                            font-weight: 500;
                            font-family: var(--font-family-inter);
                        }
                    </style>
                    <div class="announcement-bar__text text-center flex items-center gap-4">
                        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1.1702 2.71845C1.23668 2.71665 1.29957 2.74899 1.33731 2.8047L1.86379 3.54681C1.95903 3.68337 2.17106 3.64923 2.21957 3.4911L2.4909 2.62142C2.51067 2.55673 2.55918 2.50821 2.62387 2.48845L3.49356 2.21712C3.65348 2.1686 3.68582 1.95657 3.54926 1.86134L2.80715 1.33485C2.75145 1.29532 2.7209 1.23423 2.7209 1.16774L2.73168 0.256728C2.73348 0.089619 2.54301 -0.0074123 2.41004 0.0914158L1.67872 0.635869C1.62661 0.6754 1.55653 0.686181 1.49364 0.664619L0.631137 0.371728C0.473012 0.317822 0.322075 0.46876 0.375981 0.626885L0.668871 1.48938C0.690434 1.55228 0.679653 1.62235 0.640122 1.67446L0.0956674 2.40579C-0.00316072 2.53876 0.0920746 2.72923 0.260981 2.72743L1.1702 2.71845Z" fill="#2AAD52"/>
                            <path d="M14.1994 5.94564L5.94811 14.1969C5.4899 14.6551 5.63006 15.4295 6.21943 15.6973L8.72428 16.8347L11.8257 18.2434L14.5875 19.4959L17.6871 20.9046L19.5289 21.7402C19.944 21.9288 20.4345 21.8426 20.7579 21.5192L21.5216 20.7555C21.8451 20.432 21.9313 19.9415 21.7426 19.5264L20.2387 16.213L18.4795 12.3407L16.9126 8.88892L15.6997 6.21696C15.529 5.84501 15.1589 5.65275 14.7941 5.67611C14.5803 5.69048 14.3683 5.77673 14.1994 5.94564Z" fill="#FFD243"/>
                            <path d="M18.4794 12.3407L14.5874 19.4959L17.687 20.9028L20.2385 16.213L18.4794 12.3407Z" fill="#DA2C38"/>
                            <path d="M14.7941 5.67431L8.72425 16.8329L11.8257 18.2417L16.9126 8.88892L15.6997 6.21697C15.5308 5.84501 15.1607 5.65095 14.7941 5.67431Z" fill="#DA2C38"/>
                            <path d="M11.2166 5.91329C11.2849 5.91329 11.355 5.88634 11.4071 5.83423C11.5131 5.72821 11.5131 5.55751 11.4071 5.45329C10.0307 4.07689 10.0307 1.83618 11.4071 0.459777C11.5131 0.353761 11.5131 0.183058 11.4071 0.0788393C11.3011 -0.0253794 11.1304 -0.0271763 11.0261 0.0788393C9.4395 1.66548 9.4395 4.24759 11.0261 5.83603C11.0782 5.88634 11.1483 5.91329 11.2166 5.91329Z" fill="#FFD243"/>
                            <path d="M0.271783 11.4836C0.340065 11.4836 0.410142 11.4566 0.462252 11.4045C1.83866 10.0281 4.07936 10.0281 5.45577 11.4045C5.56178 11.5106 5.73249 11.5106 5.83671 11.4045C5.94092 11.2985 5.94272 11.1278 5.83671 11.0236C4.25006 9.43696 1.66796 9.43696 0.0795178 11.0236C-0.0264978 11.1296 -0.0264978 11.3003 0.0795178 11.4045C0.133424 11.4566 0.203502 11.4836 0.271783 11.4836Z" fill="#FFD243"/>
                            <path d="M7.86718 5.35447C7.92468 5.35447 7.98039 5.3365 8.0307 5.30056C8.14929 5.21072 8.17265 5.04181 8.08281 4.92322C6.92383 3.39408 6.69023 1.98173 7.37125 0.607122C7.43773 0.474153 7.38203 0.312434 7.24906 0.24595C7.11609 0.179466 6.95437 0.235169 6.88789 0.368137C6.11883 1.92243 6.37758 3.56478 7.65336 5.25025C7.70547 5.31853 7.78633 5.35447 7.86718 5.35447Z" fill="#DA2C38"/>
                            <path d="M5.0874 8.13423C5.16826 8.13423 5.24912 8.0965 5.30303 8.02822C5.39287 7.90962 5.36951 7.74072 5.25092 7.65087C3.56724 6.37329 1.9249 6.11634 0.368808 6.8854C0.235839 6.95189 0.180136 7.11361 0.24662 7.24657C0.313105 7.37954 0.474823 7.43345 0.607792 7.36876C1.9824 6.68775 3.39474 6.92134 4.92388 8.08032C4.9742 8.11626 5.0317 8.13423 5.0874 8.13423Z" fill="#DA2C38"/>
                            <path d="M3.28506 19.3162C2.771 19.3162 2.35427 18.8995 2.35427 18.3854C2.35427 17.8713 2.771 17.4546 3.28506 17.4546C3.79911 17.4546 4.21584 17.8713 4.21584 18.3854C4.21584 18.8995 3.79911 19.3162 3.28506 19.3162Z" fill="#DA2C38"/>
                            <path d="M20.3285 8.22407C19.8145 8.22407 19.3977 7.80735 19.3977 7.29329C19.3977 6.77924 19.8145 6.36251 20.3285 6.36251C20.8426 6.36251 21.2593 6.77924 21.2593 7.29329C21.2593 7.80735 20.8426 8.22407 20.3285 8.22407Z" fill="#2AAD52"/>
                            <path d="M17.1785 3.90798C17.3995 3.90798 17.6151 3.83431 17.7948 3.77501C18.138 3.65821 18.3033 3.62048 18.4471 3.74806C18.5585 3.84689 18.7292 3.8361 18.828 3.7265C18.9269 3.61509 18.9179 3.44439 18.8065 3.34556C18.413 2.99696 17.9565 3.1515 17.6223 3.2647C17.2791 3.38149 17.1138 3.41923 16.9701 3.29165C16.8101 3.1497 16.8299 2.92689 16.8748 2.5747C16.9233 2.19735 16.9844 1.72657 16.6035 1.38696C16.21 1.03837 15.7536 1.1929 15.4194 1.3061C15.0762 1.4229 14.9108 1.46064 14.7671 1.33306C14.6557 1.23423 14.485 1.24501 14.3862 1.35462C14.2873 1.46603 14.2981 1.63673 14.4077 1.73556C14.7994 2.08415 15.2576 1.92962 15.5901 1.81642C15.9333 1.69962 16.0986 1.66189 16.2423 1.78946C16.4022 1.93142 16.3825 2.15423 16.3376 2.50642C16.289 2.88376 16.228 3.35454 16.6089 3.69415C16.794 3.85407 16.988 3.90798 17.1785 3.90798Z" fill="#DA2C38"/>
                            <path d="M6.02349 6.29782C6.09178 6.29782 6.16185 6.27087 6.21396 6.21876C6.31998 6.11275 6.31998 5.94204 6.21396 5.83782L4.77467 4.39853C4.66865 4.29251 4.49795 4.29251 4.39373 4.39853C4.28951 4.50454 4.28771 4.67525 4.39373 4.77946L5.83302 6.21876C5.88513 6.27087 5.95342 6.29782 6.02349 6.29782Z" fill="#FFD243"/>
                            </svg>                            
                        <div class="announcement-bar__inner">
                            {{ block.settings.title }}
                        </div>
                        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.6711 2.71845C20.6046 2.71665 20.5418 2.74899 20.504 2.8047L19.9775 3.54681C19.8823 3.68337 19.6703 3.64923 19.6218 3.4911L19.3504 2.62142C19.3307 2.55673 19.2821 2.50821 19.2175 2.48845L18.3478 2.21712C18.1878 2.1686 18.1555 1.95657 18.2921 1.86134L19.0342 1.33485C19.0899 1.29532 19.1204 1.23423 19.1204 1.16774L19.1096 0.256728C19.1078 0.089619 19.2983 -0.0074123 19.4313 0.0914158L20.1626 0.635869C20.2147 0.6754 20.2848 0.686181 20.3477 0.664619L21.2102 0.371728C21.3683 0.317822 21.5193 0.46876 21.4653 0.626885L21.1725 1.48938C21.1509 1.55228 21.1617 1.62235 21.2012 1.67446L21.7457 2.40579C21.8445 2.53876 21.7493 2.72923 21.5803 2.72743L20.6711 2.71845Z" fill="#2AAD52"/>
                            <path d="M7.64197 5.94564L15.8932 14.1969C16.3514 14.6551 16.2113 15.4295 15.6219 15.6973L13.117 16.8347L10.0156 18.2434L7.25385 19.4959L4.15424 20.9046L2.31244 21.7402C1.89736 21.9288 1.40682 21.8426 1.08338 21.5192L0.319707 20.7555C-0.00373032 20.432 -0.0899802 19.9415 0.0986916 19.5264L1.60268 16.213L3.36182 12.3407L4.92869 8.88892L6.14158 6.21696C6.31228 5.84501 6.68244 5.65275 7.04721 5.67611C7.26103 5.69048 7.47307 5.77673 7.64197 5.94564Z" fill="#FFD243"/>
                            <path d="M3.36192 12.3407L7.25395 19.4959L4.15435 20.9028L1.60278 16.213L3.36192 12.3407Z" fill="#DA2C38"/>
                            <path d="M7.04723 5.67431L13.1171 16.8329L10.0157 18.2417L4.92871 8.88892L6.1416 6.21697C6.31051 5.84501 6.68066 5.65095 7.04723 5.67431Z" fill="#DA2C38"/>
                            <path d="M10.6247 5.91329C10.5564 5.91329 10.4864 5.88634 10.4342 5.83423C10.3282 5.72821 10.3282 5.55751 10.4342 5.45329C11.8107 4.07689 11.8107 1.83618 10.4342 0.459777C10.3282 0.353761 10.3282 0.183058 10.4342 0.0788393C10.5403 -0.0253794 10.711 -0.0271763 10.8152 0.0788393C12.4018 1.66548 12.4018 4.24759 10.8152 5.83603C10.7631 5.88634 10.693 5.91329 10.6247 5.91329Z" fill="#FFD243"/>
                            <path d="M21.5695 11.4836C21.5013 11.4836 21.4312 11.4566 21.3791 11.4045C20.0027 10.0281 17.762 10.0281 16.3856 11.4045C16.2795 11.5106 16.1088 11.5106 16.0046 11.4045C15.9004 11.2985 15.8986 11.1278 16.0046 11.0236C17.5913 9.43696 20.1734 9.43696 21.7618 11.0236C21.8678 11.1296 21.8678 11.3003 21.7618 11.4045C21.7079 11.4566 21.6378 11.4836 21.5695 11.4836Z" fill="#FFD243"/>
                            <path d="M13.9741 5.35447C13.9166 5.35447 13.8609 5.3365 13.8106 5.30056C13.692 5.21072 13.6687 5.04181 13.7585 4.92322C14.9175 3.39408 15.1511 1.98173 14.4701 0.607122C14.4036 0.474153 14.4593 0.312434 14.5923 0.24595C14.7252 0.179466 14.887 0.235169 14.9534 0.368137C15.7225 1.92243 15.4637 3.56478 14.188 5.25025C14.1359 5.31853 14.055 5.35447 13.9741 5.35447Z" fill="#DA2C38"/>
                            <path d="M16.7539 8.13423C16.6731 8.13423 16.5922 8.0965 16.5383 8.02822C16.4485 7.90962 16.4718 7.74072 16.5904 7.65087C18.2741 6.37329 19.9164 6.11634 21.4725 6.8854C21.6055 6.95189 21.6612 7.11361 21.5947 7.24657C21.5282 7.37954 21.3665 7.43345 21.2335 7.36876C19.8589 6.68775 18.4466 6.92134 16.9174 8.08032C16.8671 8.11626 16.8096 8.13423 16.7539 8.13423Z" fill="#DA2C38"/>
                            <path d="M18.5563 19.3162C19.0703 19.3162 19.4871 18.8995 19.4871 18.3854C19.4871 17.8713 19.0703 17.4546 18.5563 17.4546C18.0422 17.4546 17.6255 17.8713 17.6255 18.3854C17.6255 18.8995 18.0422 19.3162 18.5563 19.3162Z" fill="#DA2C38"/>
                            <path d="M1.51281 8.22407C2.02687 8.22407 2.44359 7.80735 2.44359 7.29329C2.44359 6.77924 2.02687 6.36251 1.51281 6.36251C0.998756 6.36251 0.582031 6.77924 0.582031 7.29329C0.582031 7.80735 0.998756 8.22407 1.51281 8.22407Z" fill="#2AAD52"/>
                            <path d="M4.66283 3.90798C4.44181 3.90798 4.22619 3.83431 4.0465 3.77501C3.7033 3.65821 3.53798 3.62048 3.39423 3.74806C3.28283 3.84689 3.11212 3.8361 3.0133 3.7265C2.91447 3.61509 2.92345 3.44439 3.03486 3.34556C3.42837 2.99696 3.88478 3.1515 4.219 3.2647C4.5622 3.38149 4.72751 3.41923 4.87127 3.29165C5.03119 3.1497 5.01142 2.92689 4.9665 2.5747C4.91798 2.19735 4.85689 1.72657 5.23783 1.38696C5.63134 1.03837 6.08775 1.1929 6.42197 1.3061C6.76517 1.4229 6.93048 1.46064 7.07423 1.33306C7.18564 1.23423 7.35634 1.24501 7.45517 1.35462C7.554 1.46603 7.54322 1.63673 7.43361 1.73556C7.04189 2.08415 6.58369 1.92962 6.25126 1.81642C5.90806 1.69962 5.74275 1.66189 5.599 1.78946C5.43908 1.93142 5.45884 2.15423 5.50377 2.50642C5.55228 2.88376 5.61337 3.35454 5.23244 3.69415C5.04736 3.85407 4.8533 3.90798 4.66283 3.90798Z" fill="#DA2C38"/>
                            <path d="M15.8178 6.29782C15.7496 6.29782 15.6795 6.27087 15.6274 6.21876C15.5213 6.11275 15.5213 5.94204 15.6274 5.83782L17.0667 4.39853C17.1727 4.29251 17.3434 4.29251 17.4476 4.39853C17.5518 4.50454 17.5536 4.67525 17.4476 4.77946L16.0083 6.21876C15.9562 6.27087 15.8879 6.29782 15.8178 6.29782Z" fill="#FFD243"/>
                            </svg>
                            
                    </div>
                    {% else %}
                        <div class="announcement-bar__text flex items-center gap-2">
                            {% if block.settings.icon != blank %}
                                {{ block.settings.icon }}
                            {% endif %}
                            {{ block.settings.title }}
                        </div>
                {% endif %}
              {%- when "badge" -%}
                <a class="announcement-bar__badge flex items-center gap-2" style="background-color: {{ block.settings.background_color }};" href="{{ block.settings.link }}">
                    {{ block.settings.text }}
                </a>

                <style>
                    .announcement-bar {
                        cursor: pointer;
                    }
                </style>
                <script>
                    document.querySelector(".announcement-bar").addEventListener("click", function() {
                        window.location.href = "{{ block.settings.link }}";
                    });
                </script>
                
              {%- when "timer" -%}
                <div class="announcement-bar__timer {% if block.settings.white_skin %}announcement-bar__timer--white-skin{% endif %}" data-timer="{{ block.settings.end_date }}">
                    <div class="timer-block flex items-center gap-2">
                        {% unless timer.settings.hide_days %}
                        <div class="timer-block__cell flex flex-col items-center justify-center">
                            <span data-cell="days">00</span>
                            <span>Dys</span>
                        </div>
                        <span class="timer-block__divider flex flex-col items-center justify-center"></span>
                        {% endunless %}
                        
                        <div class="timer-block__cell flex flex-col items-center justify-center">
                            <span data-cell="hours">05</span>
                            <span>Hrs</span>
                        </div>
                        <span class="timer-block__divider flex flex-col items-center justify-center"></span>
                        <div class="timer-block__cell flex flex-col items-center justify-center">
                            <span data-cell="minutes">33</span>
                            <span>Min</span>
                        </div>
                        <span class="timer-block__divider flex flex-col items-center justify-center"></span>
                        <div class="timer-block__cell flex flex-col items-center justify-center">
                            <span data-cell="seconds">47</span>
                            <span>Sec</span>
                        </div>
                    </div>
                </div>
            {% endcase %}
          {% endfor %}
    </div>
</div>

{% if timer != blank %}
    <script>
        (function () {
          const section = document.querySelector("#{{ section.id }}");
          const timerElement = section.querySelector("[data-timer]");
          const attributes = ["days","hours","minutes","seconds"]

          {% if timer.settings.hide_days %}
            attributes.splice(0, 1);
          {% endif %}
          
          function parseDateInput(dateStr) {
            const [datePart, timePart] = dateStr.trim().split(" ");
            const [day, month, year] = datePart.split("-").map(Number);
          
            let hours = 0, minutes = 0;
            if (timePart) {
              [hours, minutes] = timePart.split(":").map(Number);
            }
            return new Date(Date.UTC(year, month - 1, day, hours, minutes));
          }
      
          function startCountdown(endDateStr) {
            const endTime = endDateStr ? parseDateInput(endDateStr) : new Date().setHours(23, 59, 59);
        
            function updateTimer() {
              const now = new Date();
              const timeDiff = endTime - now;
        
              if (timeDiff <= 0) {
                clearInterval(timerInterval);
                return;
              }
        
              const params = {
                days: Math.floor(timeDiff / (1000 * 60 * 60 * 24)),
                hours: Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
                minutes: Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60)),
                seconds: Math.floor((timeDiff % (1000 * 60)) / 1000)
              }
              attributes.forEach(attribute => {
                timerElement.querySelector(`[data-cell="${attribute}"]`).textContent = String(params[attribute]).padStart(2, '0')
              })
            }
        
            const timerInterval = setInterval(updateTimer, 900);
            updateTimer();
          }
        
          startCountdown("{{ timer.settings.end_date }}");
        })()
    </script>
{% endif %}

{% schema %}
{
  "name": "Announcement Bar",
  "tag": "div",
  "settings": [
    {
      "type": "color",
      "label": "Background Color",
      "id": "background_color",
      "default": "#0D3063"
    },
    {
      "type": "color",
      "label": "Text Color",
      "id": "text_color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "label": "Vertical Indent",
      "id": "vertical_indent",
      "min": 0,
      "max": 100,
      "default": 6,
      "step": 2
    },
    {
      "type": "range",
      "label": "Gap Between Blocks",
      "id": "gap",
      "min": 0,
      "max": 100,
      "default": 10,
      "step": 2
    },
    {
      "type": "select",
      "label": "Horizontal Text Alignment",
      "id": "text_alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },   
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    }
  ],
  "blocks": [
    {
      "name": "Text",
      "type": "text",
      "settings": [
        {
          "type": "range",
          "label": "Font Size",
          "id": "font_size",
          "min": 10,
          "max": 48,
          "default": 14,
          "step": 2
        },
        {
          "type": "textarea",
          "label": "Icon",
          "id": "icon"
        },
        {
          "type": "richtext",
          "label": "Text",
          "id": "title",
          "default": "<p>Summer Sale</p>"
        }
      ]
    },
    {
      "name": "Button",
      "type": "badge",
      "settings": [
        {
          "type": "color",
          "label": "Background Color",
          "id": "background_color",
          "default": "#E30000"
        },
        {
          "type": "text",
          "label": "Text",
          "id": "text",
          "default": "UP TO 60% OFF"
        },
        {
          "type": "url",
          "label": "Link",
          "id": "link"
        }
      ]
    },
    {
      "name": "Timer",
      "type": "timer",
      "settings": [
        {
            "type": "checkbox",
            "label": "White Skin",
            "id": "white_skin",
            "default": false
        },
        {
          "type": "checkbox",
          "label": "Hide Days",
          "id": "hide_days",
          "default": true
        },
        {
          "type": "text",
          "label": "End Date",
          "id": "end_date",
          "info": "Format: DD-MM-YYYY HH:MM",
          "default": "23-07-2027 12:00"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Bar"
    }
  ]
}
{% endschema %}