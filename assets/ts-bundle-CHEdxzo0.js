class c extends HTMLElement{constructor(){var e;super(),this.quantityOptions=this.querySelector("#TSBundleQuantityOptions"),this.footer=this.querySelector("[data-footer]"),this.currentQuantity=0,this.requiredQuantity=0,this.proceedButtonTemplate="Select {quantity} More Pouches",this.proceedButtonTemplateSingle="Select 1 More Pouch",this.proceedButton=this.footer.querySelector("button"),this.sellingPlanTitle="",this.pricePerItem=0,this.comparePricePerItem=0,this.onQuantityOptionChange(),(e=this.quantityOptions)==null||e.addEventListener("change",this.onQuantityOptionChange.bind(this)),this.setOnClick()}onQuantityOptionChange(){const e=this.quantityOptions.querySelector("input:checked");this.requiredQuantity=parseInt(e.value),this.querySelectorAll("[data-gift-option]").forEach(t=>{const i=parseInt(t.getAttribute("data-gift-requirements"));t.toggleAttribute("disabled",i>this.requiredQuantity)}),this.sellingPlanTitle=e.getAttribute("data-selling-title"),this.pricePerItem=parseInt(e.getAttribute("data-price")),this.comparePricePerItem=parseInt(e.getAttribute("data-compare")),this.footer.querySelector("[data-savings]").innerText=e.dataset.savings,this.querySelector("[data-shipping]")&&(this.querySelector("[data-shipping]").innerText=e.dataset.shippingTitle),this.updateProceedButton()}updateProceedButton(){const e=this.requiredQuantity-this.currentQuantity;e>0?(e==1?this.proceedButton.querySelector("[data-label]").innerText=this.proceedButtonTemplateSingle:this.proceedButton.querySelector("[data-label]").innerText=this.proceedButtonTemplate.replace("{quantity}",e),this.proceedButton.setAttribute("disabled",!0)):this.proceedButton.removeAttribute("disabled");const t=this.quantityOptions.querySelector("input:checked"),i=Math.max(this.currentQuantity,this.requiredQuantity),a=parseInt(t.dataset.discount);let n=this.pricePerItem*i/100,r=this.comparePricePerItem*i/100;a>0&&(n=(this.comparePricePerItem*i-a)/100),this.footer.querySelector("[data-compare]").innerText=`$${r.toFixed(2)}`,this.footer.querySelector("[data-price]").innerText=`$${n.toFixed(2)}`}updateQuantity(){this.currentQuantity=0,this.querySelectorAll("[name='option-quantity']").forEach(e=>{this.currentQuantity+=parseInt(e.value)}),this.updateProceedButton()}addToCart(){const e={items:[]};this.querySelector('[name="bundle-quantity"]:checked'),this.querySelectorAll("[data-gift-option]:not([disabled])").forEach(t=>{const i=t.getAttribute("data-gift-option");i!==""&&e.items.push({id:parseInt(i),quantity:1})}),this.querySelectorAll("[name='option-quantity']").forEach(t=>{const i=t.closest("[data-option-controls]"),a=t.getAttribute("data-product"),n=parseInt(t.value),r=JSON.parse(i.querySelector("[data-plans]").textContent);if(a!==""&&n>0){const s={id:parseInt(a),quantity:n};r.plans&&r.plans.forEach(o=>{o.name==this.sellingPlanTitle&&(s.selling_plan=parseInt(o.id))}),e.items.push(s)}}),fetch(window.Shopify.routes.root+"cart/clear.js").then(()=>{fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{window.location.pathname="/checkout"}).catch(t=>console.error(t))})}setOnClick(){this.addEventListener("click",e=>{if(e.target.hasAttribute("data-action")){const t=e.target.closest("[data-option-controls]"),i=(t==null?void 0:t.querySelector("input"))||!1;switch(e.target.dataset.action){case"add":t&&i&&(t.classList.remove("disabled"),i.value=1,this.updateQuantity());break;case"increase":if(t&&i){const a=parseInt(i.value);i.value=a+1,this.updateQuantity()}break;case"decrease":if(t&&i){const a=parseInt(i.value);i.value=a-1,a===1&&t.classList.add("disabled"),this.updateQuantity()}break;case"proceed":this.addToCart();break}}})}}customElements.define("ts-bundle",c);
//# sourceMappingURL=ts-bundle-CHEdxzo0.js.map
