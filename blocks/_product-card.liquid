{% assign bst = block.settings %}
{% assign product = bst.product %}
{% assign faqs = product.metafields.custom.product_section_faq.value %}
{% assign productPuprose = product.metafields.custom.product_puprose %}
{% assign featured_image = bst.featured_image | default: product.featured_image %}

{% capture checkout_url %}
    {% if product.metafields.custom.use_offer_page_with_gifts_instead_checkout %}
        /pages/offer?product-handle={{ product.handle }}
    {% else %}
        /pages/checkout?product-handle={{ product.handle }}
    {% endif %}
{% endcapture %}

<div class="product-card" data-puprose="{{ productPuprose }}">
    <div class="product-card__image">
        <a href="{{ product.url }}" class="block">
            {% render 'img', image: featured_image, max_width: 400, alt: product.title %}
        </a>
    </div>
    <div class="product-card__content pt-5">
        <div class="product-card__rating flex gap-2 items-center pb-2 font-family-poppins">
            {% render 'stars', score: 5 %}
            <div class="text-[1.4rem] md:text-[1.3rem]">
                {{ bst.text_rating }}
            </div>
        </div>
        <div class="product-card__title font-bold font-family-poppins mb-4">
            <a href="{{ product.url }}" class="block">
                {{ bst.title }}
            </a>
        </div>
        <div class="product-card__description mb-4">
            {{ bst.description }}
        </div>
        <div class="product-card__features mb-6 md:mb-8">
            {{ bst.features }}
        </div>

        <div class="product-card__cta flex gap-2">
            <a href="{{ product.url }}" class="btn btn--secondary">
                See More Details
            </a>

            <a href="{{ checkout_url }}" class="btn btn-primary btn--cart">
                Choose Package
            </a>
        </div>

        <div class="product-card__faqs mt-3 md:mt-6 pb-3">
            {% assign answer_1 = faqs.answer_1 | metafield_tag %}
            {% assign answer_2 = faqs.answer_2 | metafield_tag %}
            {% assign answer_3 = faqs.answer_3 | metafield_tag %}

            {% render 'accordion-item', question: faqs.question_1, answer: answer_1 %}
            {% render 'accordion-item', question: faqs.question_2, answer: answer_2 %}
            {% render 'accordion-item', question: faqs.question_3, answer: answer_3 %}
        </div>
    </div>
</div>

{% schema %}
{
  "name": "Product Card",
  "tag": null,
  "settings": [
    {
      "type": "checkbox",
      "label": "Use as Default",
      "id": "use_as_default",
      "default": false
    },
    {
      "type": "product",
      "label": "Related Product",
      "id": "product"
    },
    {
      "type": "image_picker",
      "label": "Featured Image",
      "id": "featured_image",
      "info": "If not set, the product's featured image will be used"
    },
    {
      "type": "richtext",
      "label": "Text Rating",
      "id": "text_rating",
      "default": "<p>Excellent <b>4.9</b> | 12,000+ Trusted Reviews</p>"
    },
    {
      "type": "text",
      "label": "Title",
      "id": "title"
    },
    {
      "type": "richtext",
      "label": "Description",
      "id": "description"
    },
    {
      "type": "richtext",
      "label": "Features",
      "id": "features"
    }
  ],
  "presets": [
    {
      "name": "Product Card"
    }
  ]
}
{% endschema %}