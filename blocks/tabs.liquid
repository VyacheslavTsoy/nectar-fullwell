{% assign bst = block.settings %}

<div class="tabs" id="{{ block.id }}" x-data="tabs">
    <div class="container">
        <div class="tabs__nav">
            <div class="btn-group flex gap-2 justify-center mb-4">
                <div class="btn-group__inner py-1.5 px-1.5 flex gap-2 bg-white">
                    <template x-for="tab in tabs" :key="tab">
                        <button class="btn-sm" x-text="tab" @click="activeTab = tab" :class="{ 'btn-sm--active': tab === activeTab }"></button>
                    </template>
                </div>
            </div>
        </div>

        <div class="tabs__content">
            {% content_for 'blocks' %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('tabs', () => ({
            tabs: [],
            activeTab: null,
          
            collectTabs() {
              const parentEl = this.$el.closest('.tabs');
              const tabs = parentEl.querySelectorAll('.tab-item[data-tab-name]');
          
              const uniqueTabs = new Set();
          
              tabs.forEach(tab => {
                const tabName = tab.dataset.tabName;
                if (tabName) uniqueTabs.add(tabName);
              });
          
              this.tabs = Array.from(uniqueTabs);
            },

            filterByTab() {
                const parentEl = this.$el.closest('.tabs');
                const tabs = parentEl.querySelectorAll('.tab-item[data-tab-name]');

                tabs.forEach(tab => {
                    tab.style.display =
                    tab.dataset.tabName === this.activeTab ? 'block' : 'none';
                });
            },
          
            init() {
              this.collectTabs();
              this.activeTab = this.tabs[0] || null;
          
              this.$watch('activeTab', () => {
                this.filterByTab();
              });
        
              this.filterByTab();
            }
          }));
    });
</script>

{% schema %}
{
  "name": "Tabs",
  "tag": null,
  "blocks": [{"type": "_tab-item"}],
  "presets": [
    {
      "name": "Tabs",
      "blocks": [
        {"type": "_tab-item", "settings": {"title": "Calm"}},
        {"type": "_tab-item", "settings": {"title": "Hydration"}},
        {"type": "_tab-item", "settings": {"title": "Energy"}}
      ]
    }
  ]
}
{% endschema %}