{% assign bst = block.settings %}

<div class="tabs" id="{{ block.id }}" x-data="tabs">
    <div class="container">
        <div class="tabs__nav">
            <div class="btn-group w-full md:w-auto flex gap-2 md:justify-center mb-2 md:mb-4">
                <div class="btn-group__inner py-1.5 px-1.5 flex gap-2 w-full md:w-auto bg-white">
                    <template x-for="tab in tabs" :key="tab.handle">
                        <button class="btn-sm w-[33.3%] md:w-auto" x-text="tab.title" @click="activeTab = tab.handle" :class="{ 'btn-sm--active': tab.handle === activeTab }"></button>
                    </template>
                </div>
            </div>
        </div>

        <div class="tabs__content">
            {% content_for 'blocks' %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('tabs', () => ({
            tabs: [],
            activeTab: null,
          
            collectTabs() {
              const parentEl = this.$el.closest('.tabs');
              const tabElements = parentEl.querySelectorAll('.tab-item[data-tab-name][data-tab-handle]');
          
              const uniqueTabs = new Map();
          
              tabElements.forEach(tab => {
                const tabName = tab.dataset.tabName;
                const tabHandle = tab.dataset.tabHandle;
                
                if (tabName && tabHandle) {
                  uniqueTabs.set(tabHandle, {
                    title: tabName,
                    handle: tabHandle
                  });
                }
              });
          
              this.tabs = Array.from(uniqueTabs.values());
            },

            filterByTab() {
                const parentEl = this.$el.closest('.tabs');
                const tabs = parentEl.querySelectorAll('.tab-item[data-tab-handle]');

                tabs.forEach(tab => {
                    tab.style.display =
                    tab.dataset.tabHandle === this.activeTab ? 'block' : 'none';
                });
            },
          
            init() {
              this.collectTabs();
              this.activeTab = this.tabs[0]?.handle || null;
          
              this.$watch('activeTab', () => {
                this.filterByTab();
              });
        
              this.filterByTab();
            }
          }));
    });
</script>

{% schema %}
{
  "name": "Tabs",
  "tag": null,
  "blocks": [{"type": "_tab-item"}],
  "presets": [
    {
      "name": "Tabs",
      "blocks": [
        {"type": "_tab-item", "settings": {"title": "Calm"}},
        {"type": "_tab-item", "settings": {"title": "Hydration"}},
        {"type": "_tab-item", "settings": {"title": "Energy"}}
      ]
    }
  ]
}
{% endschema %}
